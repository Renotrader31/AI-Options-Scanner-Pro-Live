<!DOCTYPE html>
<html>
<head>
    <title>Portfolio Export Tool</title>
    <style>
        body { 
            font-family: Arial; 
            padding: 20px; 
            background: #f0f8ff; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .box { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 15px 0; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { border-left: 5px solid #4CAF50; }
        .warning { border-left: 5px solid #ff9800; }
        .info { border-left: 5px solid #2196F3; }
        button { 
            background: #4CAF50; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 16px;
        }
        button:hover { background: #45a049; }
        .export-button { background: #2196F3; }
        .export-button:hover { background: #1976D2; }
        textarea { 
            width: 100%; 
            height: 200px; 
            font-family: monospace; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 5px;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üìä Portfolio Export Tool</h1>
    
    <div class="box warning">
        <h3>‚ö†Ô∏è Before Fresh Deployment</h3>
        <p>Use this tool to <strong>backup your portfolio data</strong> before creating a fresh Vercel deployment.</p>
        <p><strong>Your portfolio data is safe</strong> - it's stored in browser localStorage, but this tool lets you export it as backup.</p>
    </div>
    
    <div class="box info">
        <h3>üìã Instructions</h3>
        <ol>
            <li><strong>Click "Export Portfolio"</strong> below to backup your current trades</li>
            <li><strong>Copy the exported data</strong> (will appear in text area)</li>
            <li><strong>Save it somewhere safe</strong> (text file, email to yourself, etc.)</li>
            <li><strong>Create your fresh Vercel deployment</strong></li>
            <li><strong>Import the data</strong> into your new deployment</li>
        </ol>
    </div>
    
    <div class="box">
        <h3>üîÑ Export Your Portfolio</h3>
        <button onclick="exportPortfolio()" class="export-button">üìä Export Portfolio Data</button>
        <button onclick="clearData()" style="background: #f44336;">üóëÔ∏è Clear All Data</button>
        
        <div id="status"></div>
        
        <h4>üìÑ Exported Data (Copy This):</h4>
        <textarea id="exportData" placeholder="Exported portfolio data will appear here..."></textarea>
    </div>
    
    <div class="box">
        <h3>üì• Import Portfolio (For New Deployment)</h3>
        <p>After creating your fresh deployment, paste your exported data here and click import:</p>
        <textarea id="importData" placeholder="Paste your exported portfolio data here..."></textarea>
        <br>
        <button onclick="importPortfolio()">üì• Import Portfolio Data</button>
    </div>
    
    <div class="box success">
        <h3>‚úÖ Next Steps</h3>
        <ol>
            <li>Export your data using the button above</li>
            <li>Go create your fresh Vercel deployment</li>
            <li>Open the new URL and navigate to this same export tool page</li>
            <li>Import your portfolio data</li>
            <li>Verify all your trades appear correctly with the fixes!</li>
        </ol>
    </div>

    <script>
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.className = `status ${isError ? 'error' : 'success'}`;
            status.textContent = message;
            setTimeout(() => status.textContent = '', 5000);
        }

        function exportPortfolio() {
            try {
                // Get all localStorage data
                const portfolioData = {};
                
                // Common localStorage keys used by the portfolio app
                const keys = [
                    'portfolio', 'trades', 'portfolioData', 'userTrades', 
                    'optionsTrades', 'savedTrades', 'tradingData'
                ];
                
                let foundData = false;
                
                // Check each possible key
                keys.forEach(key => {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            portfolioData[key] = JSON.parse(data);
                            foundData = true;
                        } catch (e) {
                            portfolioData[key] = data; // Store as string if not JSON
                        }
                    }
                });
                
                // Also get all keys that might be portfolio-related
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && !keys.includes(key)) {
                        const data = localStorage.getItem(key);
                        try {
                            portfolioData[key] = JSON.parse(data);
                            foundData = true;
                        } catch (e) {
                            portfolioData[key] = data;
                        }
                    }
                }
                
                if (foundData) {
                    const exportString = JSON.stringify(portfolioData, null, 2);
                    document.getElementById('exportData').value = exportString;
                    showStatus(`‚úÖ Exported ${Object.keys(portfolioData).length} data items from localStorage`);
                } else {
                    showStatus('‚ö†Ô∏è No portfolio data found in localStorage', true);
                    document.getElementById('exportData').value = 'No portfolio data found';
                }
                
            } catch (error) {
                showStatus(`‚ùå Export failed: ${error.message}`, true);
                console.error('Export error:', error);
            }
        }
        
        function importPortfolio() {
            try {
                const importText = document.getElementById('importData').value.trim();
                
                if (!importText) {
                    showStatus('‚ùå Please paste exported data first', true);
                    return;
                }
                
                const portfolioData = JSON.parse(importText);
                let importedCount = 0;
                
                // Import each piece of data back to localStorage
                Object.keys(portfolioData).forEach(key => {
                    const value = typeof portfolioData[key] === 'string' 
                        ? portfolioData[key] 
                        : JSON.stringify(portfolioData[key]);
                    
                    localStorage.setItem(key, value);
                    importedCount++;
                });
                
                showStatus(`‚úÖ Successfully imported ${importedCount} data items to localStorage`);
                
                // Suggest page refresh
                setTimeout(() => {
                    if (confirm('Portfolio data imported! Refresh the page to see your trades?')) {
                        window.location.reload();
                    }
                }, 1000);
                
            } catch (error) {
                showStatus(`‚ùå Import failed: ${error.message}`, true);
                console.error('Import error:', error);
            }
        }
        
        function clearData() {
            if (confirm('‚ö†Ô∏è This will delete ALL portfolio data from localStorage. Are you sure?')) {
                localStorage.clear();
                showStatus('üóëÔ∏è All localStorage data cleared');
                document.getElementById('exportData').value = '';
                document.getElementById('importData').value = '';
            }
        }
        
        // Auto-export on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Portfolio Export Tool Ready');
            // Automatically try to export existing data
            setTimeout(exportPortfolio, 500);
        });
    </script>
</body>
</html>